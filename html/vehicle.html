<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>vehicle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-status-bar-style" content="black">
  <!-- 样式重置 -->
  <link rel="stylesheet" href="../css/reset.css">
  <!--mui样式应用-->
  <link href="../css/mui.min.css" rel="stylesheet" />
  <!--自定义图标样式-->
  <link rel="stylesheet" type="text/css" href="../css/style-icon.css" />
  <!--自定义页面样式-->
  <link rel="stylesheet" type="text/css" href="../css/style-common.css" />
  <!--独立样式-->
  <style>
    header.mui-bar {
      background-color: #333;
    }

    header.mui-bar * {
      color: #fff;
    }

    .mui-scroll-wrapper,
    .mui-scroll {
      background-color: transparent;
    }

    .wrapper {
      height: 44px;
      width: 100%;
      position: relative;
      overflow: hidden;

    }

    .scroller {
      position: absolute;
      height: 100%;
    }

    .wrapper ul li {
      float: left;
      height: 100%;
      line-height: 44px;
      padding: 0 20px;
      position: relative;
    }

    .wrapper ul li:after {
      content: "";
      width: 80%;
      height: 2px;
      background-color: transparent;
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%)
    }

    .wrapper ul li.active a {
      color: #2885cf;

    }

    .wrapper ul li.active:after {
      background-color: #2885cf;
    }

    .wrapper ul li a {
      font-size: 16px;
      height: 100%;
      display: inline-block
    }
  </style>
</head>

<body>
  <header class="mui-bar mui-bar-nav">
    <div id="slider" class="mui-slider">
      <div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
        <div class="mui-scroll">
          <a id="defaultTab" class="mui-control-item mui-active" href="vehicle-list.html">车辆总表</a>
          <a id="vehicle-check-up" class="mui-control-item" href="vehicle-check-up.html">接车点检</a>
          <a id="vehicle-input-list" class="mui-control-item" href="vehicle-input-list.html">车辆录入</a>
          <a id="vehicle-insurance-input" class="mui-control-item" href="vehicle-insurance-list.html">保险列表</a>
          <a id="vehicle-insurance-input" class="mui-control-item" href="vehicle-license-list.html">临牌列表</a>
          <!-- <a id="vehicle-check-down" class="mui-control-item" href="vehicle-check-down.html">还车点检</a> -->
        </div>
      </div>
    </div>
  </header>
  <!-- jquery -->
  <script src="../js/lib/jquery.min.js"></script>
  <!-- mui -->
  <script src="../js/mui.min.js"></script>
  <!-- config 配置项 -->
  <script src="../js/app/config.js"></script>
  <!-- app 数据获取 -->
  <script src="../js/app/app.js"></script>
  <!-- 当前页面js -->
  <script>
    (function () {

      mui.init();
      //子页面列表
      var subpages = ['vehicle-list.html', 'vehicle-check-up.html', 'vehicle-input-list.html', 'vehicle-insurance-list.html', 'vehicle-license-list.html', 'vehicle-check-down.html'];
      // 子页面切换样式
      var subpages_style = {
        top: '64px',
        bottom: '0px'
      }
      //页面切换动画
      var aniShow = {};
      //页面传值
      var extras = {}
      // 创建子页面，显示首个选项卡其他都影藏
      mui.plusReady(function () {
        //更改状态栏颜色
        plus.navigator.setStatusBarStyle("light");

        if (plus.device.model === 'iPhoneX') {
          //子页面导入样式重置
          subpages_style.top = 88 + 'px';
          //传参重置
          //页面样式重置
          $('header').css({
            'height': '88px',
            'paddingTop': '40px'
          })
        }

        var self = plus.webview.currentWebview();

        extras.H = self.H;

        for (var i = 0; i < subpages.length; i++) {
          var temp = {};
          var sub = plus.webview.create(subpages[i], subpages[i], subpages_style, extras);

          if (i > 0) {
            sub.hide();
          } else {
            temp[subpages[i]] = "true";
            mui.extend(aniShow, temp);
          }
          self.append(sub);
        }

      });
      //当前激活选项
      var activeTab = subpages[0];
      //选项卡点击事件
      mui('.mui-scroll').on('tap', 'a', function (e) {
        var targetTab = this.getAttribute('href');

        if (targetTab == activeTab) {
          return;
        }
        //显示目标选项卡
        //若为iOS平台或非首次显示，则直接显示
        if (mui.os.ios || aniShow[targetTab]) {
          plus.webview.show(targetTab);
          // plus.webview.getWebviewById(targetTab).reload()
        } else {
          //否则，使用fade-in动画，且保存变量
          var temp = {};

          temp[targetTab] = "true";
          mui.extend(aniShow, temp);
          plus.webview.show(targetTab, "slide-in-right", 300);
          // plus.webview.getWebviewById(targetTab).reload()
        }
        //隐藏当前;
        plus.webview.hide(activeTab);
        //更改当前活跃的选项卡
        activeTab = targetTab;
      });

      //自定义事件，模拟点击“首页选项卡”
      document.addEventListener('gohome', function () {
        var defaultTab = document.getElementById("defaultTab");
        //模拟首页点击
        mui.trigger(defaultTab, 'tap');
        //切换选项卡高亮
        var current = document.querySelector(".mui-scroll>.mui-control-item.mui-active");
        if (defaultTab !== current) {
          current.classList.remove('mui-active');
          defaultTab.classList.add('mui-active');
        }
      });

      //接车点检
      document.addEventListener('checkup', function (e) {
        var defaultTab = document.getElementById(e.detail.domId);
        //模拟首页点击
        mui.trigger(defaultTab, 'tap');
        //切换选项卡高亮
        var current = document.querySelector(".mui-scroll>.mui-control-item.mui-active");
        if (defaultTab !== current) {
          current.classList.remove('mui-active');
          defaultTab.classList.add('mui-active');
        }
      });


      // 点击a标签时，检测下一个是否显示完全，如果不完整，则滚动到完整的位置，否则不变。
      // 点击a标签时，检测上一个是否显示完全，如果不完整，则滚动到完整的位置，否则不变。
      // 判断上/下一个是否存在
      var scroll = mui('.mui-scroll-wrapper').scroll()
      var w = $('.mui-scroll-wrapper').width();  // 可视区域的宽度
      $('.mui-scroll').on('tap', 'a', function () {
        var $next = $(this).next();
        var $prev = $(this).prev();
        var nextLeft;
        var nextWidth;
        var currentLeft;
        var currentWidth;
        var prevLeft;
        var prevWidth;
        console.log();
        var scrollx = mui('.mui-scroll-wrapper').scroll().x;  // 当前滚动值

        currentLeft = $(this).offset().left; // 下一个元素到最左边的距离
        currentWidth = $(this).outerWidth();  // 下一个的宽度

        if ($next.length > 0) {
          nextLeft = $(this).next().offset().left; // 下一个元素到最左边的距离
          nextWidth = $(this).next().outerWidth();  // 下一个的宽度
        } else {
          nextWidth = 0;
        }

        if ($prev.length > 0) {
          prevLeft = $(this).prev().offset().left; // 上一个元素到最左边的距离
          prevWidth = $(this).prev().outerWidth();  // 上一个的宽度
        } else {
          prevWidth = 0;
        }

        if (!!nextWidth && (nextLeft + nextWidth) > (w - scrollx)) {
          scroll.scrollTo(-(nextLeft + nextWidth - w - scrollx), 0, 100);
        }

        console.log(prevLeft, scrollx);

        if (!!prevWidth && (prevLeft < 0)) {
          scroll.scrollTo(scrollx - prevLeft, 0, 100);
        } 

        if ((currentLeft + currentWidth) > w) {
          if (!!nextWidth) {
            scroll.scrollTo(-(nextLeft + nextWidth - w - scrollx), 0, 100);
          } else {
            scroll.scrollTo(-(currentLeft + currentWidth - w - scrollx), 0, 100);
          }

        }

        if (currentLeft < 0) {
          if(!!prevWidth) {
            scroll.scrollTo(scrollx - prevLeft, 0, 100);
          } else {
            scroll.scrollTo(scrollx - currentLeft, 0, 100);
          }
          
        }

      })

    })()
  </script>
</body>

</html>