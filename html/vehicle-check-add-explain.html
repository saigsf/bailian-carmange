<!doctype html>
<html>

<head>
  <meta charset="UTF-8">
  <title>添加说明</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-status-bar-style" content="black">
  <!--mui样式应用-->
  <link href="../css/mui.min.css" rel="stylesheet" />
  <!--自定义图标样式-->
  <link rel="stylesheet" type="text/css" href="../css/style-icon.css" />
  <!--自定义页面样式-->
  <link rel="stylesheet" type="text/css" href="../css/style-common.css" />
  <!--独立样式-->
  <style type="text/css">
    .issue {
      line-height: 24px;
      font-size: 15px !important;
    }

    .mui-input-row textarea {
      width: 90%;
      margin: 15px auto;
      display: block;
      font-size: 14px;
      background-color: transparent;
      border: 0;
    }

    .mui-input-row p {
      margin: 0 auto;
      width: 85%;
      line-height: 30px;
      font-size: 14px;
      padding: 10px 0;
      border-bottom: 1px dashed #ccc;
      word-break: break-all
    }

    .mui-input-row p span:first-of-type {
      color: #333;
      font-weight: bold;
    }
    .explain {
      display: none;
    }
  </style>
</head>

<body>
  <header class="mui-bar mui-bar-nav">
    <a class="mui-action-back icon icon-back mui-pull-left"></a>
    <h1 class="mui-title">说明问题原因</h1>
    <a class="mui-icon mui-pull-right issue" id="issue">发表</a>
  </header>
  <div class="mui-content">
    <div class="mui-input-row explain" id="explain">
      <p>
        <span>问题原因：</span>
        <span class="explainText"></span>
      </p>
    </div>
    <div class="mui-input-row explain" id="resolvent">
      <p>
        <span>解决方法：</span>
        <span class="resolventText"></span>
      </p>
    </div>
    <div class="mui-input-row explain" id="confirm">
      <p>
        <span>确认信息：</span>
        <span class="confirmText"></span>
      </p>
    </div>
    <div class="mui-input-row">
      <textarea id="issue_text" name="" placeholder="请输入问题原因"></textarea>
    </div>

  </div>
  <!-- jquery -->
  <script src="../js/lib/jquery.min.js"></script>
  <!-- mui -->
  <script src="../js/mui.min.js"></script>
  <!-- config 配置项 -->
  <script src="../js/app/config.js"></script>
  <!-- app 数据获取 -->
  <script src="../js/app/app.js"></script>
  <!-- 当前页面js -->
  <script>
    ;
    (function () {
      mui.init();

      var self = null;
      var view = null;
      var status = null;
      var explainText = null;
      var resolventText = null;
      var confirmText = null;
      var trId = null

      // 初始化单页的区域滚动
      mui('.mui-scroll-wrapper').scroll();
      mui.plusReady(function () {
        handsetAdaption();
        $('.mui-scroll').css('min-height', $('.mui-content').height())
        self = plus.webview.currentWebview();
        view = plus.webview.getWebviewById(self.viewId);
        explainText = self.explainText;
        resolventText = self.resolventText;
        confirmText = self.confirmText;
        status = self.status;
        trId = self.trId

        // console.log(confirmText)
        if (status == 'confirm') {
          $('.mui-title').html('添加确认信息');
          $('#explain').show().find('.explainText').html(explainText);
          $('#resolvent').show().find('.resolventText').html(resolventText);
          $('#issue_text').attr('placeholder', '请输入确认信息')
          $('#issue_text').val(confirmText)
        } else if (status == 'resolvent') {
          $('.mui-title').html('添加解决方法');
          $('#explain').show().find('.explainText').html(explainText);
          $('#issue_text').attr('placeholder', '说明解决问题的方法')
          $('#issue_text').val(resolventText)
        } else if(status == 'explain') {
          $('#issue_text').val(explainText)
        } else {
          $('#explain').show().find('.explainText').html(explainText);
          $('#resolvent').show().find('.resolventText').html(resolventText);
          if(confirmText == 'NOCONFIRM') {
            $('#confirm').hide()
          } else {
            $('#confirm').show().find('.confirmText').html(confirmText);
          }
          
          $('#issue').hide()
          $('#issue_text').hide()
        }

      })

      function handsetAdaption() {
        // 更改顶部导航栏高度
        if (plus.device.model === 'iPhoneX') {
          // 页面样式重置
          $('header').css({
            'height': '88px',
            'paddingTop': '40px'
          });
          $('.mui-bar-nav~.mui-content').css({
            'paddingTop': '88px'
          })
        }

        // 弹出软键盘时自动改变webview的高度
        plus.webview.currentWebview().setStyle({
          softinputMode: "adjustResize"
        });

      }

      // 发表components
      $('#issue').off('tap', submitData).on('tap', submitData)
      function submitData() {
        if (status == 'confirm') {
          mui.fire(view, 'updateExplain', { // 触发自定义事件
            confirmText: $('#issue_text').val(),
            trId: trId,
            html: '已确认'
          });
        } else if (status == 'resolvent') {
          mui.fire(view, 'updateExplain', { // 触发自定义事件
            resolventText: $('#issue_text').val(),
            trId: trId,
            html: '已解决'
          });
        } else if (status == 'explain') {
          mui.fire(view, 'updateExplain', { // 触发自定义事件
            explainText: $('#issue_text').val(),
            trId: trId,
            html: '已说明'
          });
        }
        self.close("auto", 300);
      }

    })()
  </script>
</body>

</html>